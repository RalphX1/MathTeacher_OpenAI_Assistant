<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Tutor</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Math Tutor</h1>
        <p class="subtitle">Ask me any math question and I'll help you solve it step by step.</p>

        <form id="question-form">
            <label for="question">Enter your question:</label>
            <input type="text" id="question" name="question" placeholder="e.g., What is the derivative of x^2?" autocomplete="off">
            <button type="submit" id="submit-btn">Ask</button>
        </form>

        <div id="loading" class="hidden">
            <div class="spinner"></div>
            <span>Thinking...</span>
        </div>

        <div id="conversation"></div>
    </div>

    <script>
        const form = document.getElementById('question-form');
        const input = document.getElementById('question');
        const submitBtn = document.getElementById('submit-btn');
        const loading = document.getElementById('loading');
        const conversation = document.getElementById('conversation');

        // Generate a simple session ID
        const sessionId = 'session_' + Math.random().toString(36).substr(2, 9);

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const question = input.value.trim();
            if (!question) return;

            // Add user message to conversation
            addMessage('user', question);
            input.value = '';

            // Show loading, disable form
            loading.classList.remove('hidden');
            submitBtn.disabled = true;
            input.disabled = true;

            try {
                const response = await fetch('/api/ask', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question, sessionId })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Something went wrong');
                }

                addMessage('assistant', data.answer);
            } catch (error) {
                addMessage('error', error.message);
            } finally {
                loading.classList.add('hidden');
                submitBtn.disabled = false;
                input.disabled = false;
                input.focus();
            }
        });

        function addMessage(role, content) {
            const div = document.createElement('div');
            div.className = `message ${role}`;

            const label = document.createElement('div');
            label.className = 'message-label';
            label.textContent = role === 'user' ? 'You' : role === 'assistant' ? 'Math Tutor' : 'Error';

            const text = document.createElement('div');
            text.className = 'message-content';
            text.textContent = content;

            div.appendChild(label);
            div.appendChild(text);
            conversation.appendChild(div);

            // Scroll to bottom
            div.scrollIntoView({ behavior: 'smooth' });
        }

        // Focus input on load
        input.focus();
    </script>
</body>
</html>
